CREATE DATABASE VENDA;

USE VENDA;

--COMANDO PARA CRIAR A TABELA CLIENTE
CREATE TABLE CLIENTE (
	COD_CLIENTE INT NOT NULL PRIMARY KEY,
	NOME VARCHAR (50) NOT NULL,
	CPF VARCHAR (11) NOT NULL,
	TELEFONE BIGINT,
	ENDERECO VARCHAR (100) NOT NULL,
	CIDADE VARCHAR (100) NOT NULL
);

CREATE TABLE VENDEDOR (
	MATRICULA INT NOT NULL PRIMARY KEY,
	NOME VARCHAR (50) NOT NULL,
	TELEFONE BIGINT,
	ENDERECO VARCHAR (100) NOT NULL,
	SALARIO FLOAT NOT NULL,
	CPF VARCHAR (11) NOT NULL
);

CREATE TABLE VENDA (
	COD_VENDA INT NOT NULL PRIMARY KEY,
	DATA_VENDA DATE NOT NULL,
	VALOR FLOAT NOT NULL,
	COD_CLIENTE INT NOT NULL,
	MATRICULA INT NOT NULL
);

CREATE TABLE PRATELEIRA (
	COD_PRATELEIRA INT NOT NULL PRIMARY KEY,
	LOCALIZACAO VARCHAR (50) NOT NULL,
	SETOR VARCHAR (50)
);

CREATE TABLE PRODUTO (
	COD_PRODUTO INT NOT NULL PRIMARY KEY,
	NOME VARCHAR (100) NOT NULL,
	MARCA VARCHAR (50) NOT NULL,
	VALOR FLOAT NOT NULL,
	COD_PRATELEIRA INT
);

CREATE TABLE ITEM_VENDA (
	COD_ITEM INT NOT NULL PRIMARY KEY,
	COD_VENDA INT NOT NULL,
	COD_PRODUTO INT NOT NULL
);

--COMANDO PARA ALTERAR A TABELA VENDA E INCLUIR A CHAVE ESTRANGEIRA
ALTER TABLE VENDA 
ADD CONSTRAINT FK_CLIENTE FOREIGN KEY (COD_CLIENTE) REFERENCES CLIENTE (COD_CLIENTE);

ALTER TABLE VENDA
ADD CONSTRAINT FK_VENDEDOR FOREIGN KEY (MATRICULA) REFERENCES VENDEDOR (MATRICULA);

--COMANDO PARA INCLUIR A CHAVE ESTRANGEIRA NA TABELA PRODUTO DE PRATELEIRA
ALTER TABLE PRODUTO
ADD CONSTRAINT FK_PRATELEIRA FOREIGN KEY (COD_PRATELEIRA) REFERENCES PRATELEIRA (COD_PRATELEIRA);

--COMANDO PARA INCLUIR CHAVE ESTRANGEIRA DE PRODUTO E VENDA NA TABELA ITEM VENDA
ALTER TABLE ITEM_VENDA
ADD CONSTRAINT FK_PRODUTO FOREIGN KEY (COD_PRODUTO) REFERENCES PRODUTO (COD_PRODUTO);

ALTER TABLE ITEM_VENDA
ADD CONSTRAINT FK_VENDA FOREIGN KEY (COD_VENDA) REFERENCES VENDA (COD_VENDA);

--INSERT
INSERT INTO CLIENTE
VALUES (101, 'PEDRO', '12345678910', 1122334455, 'RUA 25 DE MARÇO', 'SÃO PAULO');

INSERT INTO CLIENTE
VALUES (102, 'ANA', '12987621313', 8127121312, 'MINNA WALENDY', 'MAUÁ'),
       (103, 'BRUNO', '09876543212', 0987654312, 'AVENIDA GOIAS', 'SÃO CAETANO DO SUL');

SELECT * FROM CLIENTE

INSERT INTO PRATELEIRA
VALUES (001, 'OESTE', 'CONGELADOS');

SELECT * FROM PRATELEIRA

INSERT INTO PRODUTO
VALUES (001, 'ROBALO', 'PEIXES MANIA', 50.76, 001);

SELECT * FROM PRODUTO

INSERT INTO VENDEDOR
VALUES (12231, 'NATHAN DANTAS' ,11961934058, 'RUA MINNA WALENDY, 118', 2500.98, 29830912121);

SELECT * FROM VENDEDOR

INSERT INTO VENDA
VALUES (123, '2021-05-25', 80, 103, 12231);

SELECT * FROM VENDA

INSERT INTO ITEM_VENDA
VALUES (11, 123, 001);

SELECT * FROM ITEM_VENDA

UPDATE VENDA
SET VALOR = 350.00
WHERE COD_VENDA = 123;


SELECT V.COD_VENDA, VEN.NOME AS VENDEDOR , C.NOME AS CLIENTE FROM VENDA V, VENDEDOR VEN, CLIENTE C
WHERE V.COD_CLIENTE = C.COD_CLIENTE AND
V.MATRICULA = VEN.MATRICULA;